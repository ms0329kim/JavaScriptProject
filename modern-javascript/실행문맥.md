# 실행 문맥(Executable Context)
## 1. 실행 가능한 코드
- 전역 코드
- 함수 코드
- eval 코드

## 2. 실행 문맥 구성
```
Execution Context = {
    Lexical Environment : {
        Environment Record : {
            Declarative Environment Record : {},
            Object Environment Record : {}
        },
        Outer Lexical Environment Reference : {}
    },
    Variable Environment : {},
    This Binding : null
}
```

### 1. Lexical Enviroment (렉시컬 환경 컴포넌트)
- 자바스크립트 엔진이 자바 스크립트 코드를 실행하기 위해 자원을 모아둔 곳
- 함수 또는 블록의 유효 범위 안에 있는 식별자와 그 결과값이 저장되는 곳
- 환경 레코드와 외부 렉시컬 환경 참조 컴포넌트로 구성
    + Environment Record (환경 레코드)
        * 유효 범위 안에 포함된 식별자를 기록하고 실행하는영역
        * 자바스크립트 엔진이 해당 자바스크립트 코드의 유효 범위 안에 있는 식별자와 그 식별자가 가리키는 값을 키와 값의 쌍으로 기록
    + Outer Lexical Environment Reference (외부 렉시컬 환경 참조)
        * 함수를 둘러싸고 있는 코드가 속한 렉시컬 환경 컴포넌트의 참조 저장
            > 유효 범위 너머의 유효 범위도 검색 가능하게 해줌

#### 환경 레코드
- 렉시컬 환경 안의 식별자와 식별자가 가리키는 값의 묶음이 실제로 저장되는 영역
- 함수의 안팎의 환경 기록 : 함수의 인자, 함수 안에서 선언된 중첩 함수의 참조, 함수 안에서 var로 선언한 지역 변수, arguments
- 선언적 환경 레코드와 객체 환경 레코드로 구성
    + 저장하는 값의 유형에 따라 달라짐
    + Declarative Environment Record (선언적 환경 레코드)
        * 실제 함수와 변수, catch 문의 식별자와 실행 결과가 저장되는 영역
    + Object Environment Record (객체 환경 레코드)
        * 실행 문맥 외부에 별도로 저장된 객체의 참조에서 데이터를 읽거나 쓴다.
        * 객체 전체의 참조를 가져와서 객체 환경 레코드의 bindObject라는 프로퍼티에 바인드하도록 만들어짐

### 2. Variable Environment

### 3. This Binding (디스 바인딩 컴포넌트)
- 그 함수를 호출한 객체의 참조가 저장되는 곳
- 이 곳이 가리키는 값이 해당 실행 문맥의 this 

## 전역 환경 생성 과정
## 1. 전역 환경 생성
- 자바스크립트 인터프리터는 시작하자마자 렉시컬 환경 타입의 전역 환경을 생성
- 전역 객체를 생성 후 전역 환경의 객체 환경 레코드에 전역 객체의 참조 대입

```
// 전역 환경
Global Environment = {
    Object Environment Record : {
        bindObject : window
    },
    Outer Lexical Environment Reference : null
}

// 전역 실행 문맥
Execution Context = {
    Lexical Environment : Global Environment,
    This Binding: window
}
```

### 2. 프로그램의 평가
- var 문으로 작성한 전역 변수는 전역 환경 레코드의 프로퍼티로 추가
- var 문과 함수 선언문으로 선언한 전역 변수는 `[[Configurable]]' 속성이 false로 설정되어 있어 삭제할 수 없다.
    > configurable 으로 참조 가능
- var 문을 사용하지 않고 변수를 선언한 경우 : 디스 바인딩 컴포넌트가 가리키는 객체의 프로퍼티로 추가

## 프로그램 실행
- 실행 문맥은 실행 가능한 코드 별로 생성
- 콜스택 구조로 관리
- 자바스크립트는 싱글 스레드 이므로 실행 문맥 단위의 작업을 차례대로 실행한다.

## 프로그램 실행 과정
1. 호출 함수의 실행 문맥 생성
2. 함수의 실행 문맥을 콜스택에 push
3. push된 실행 문맥 안에 렉시컬 환경 컴포넌트 생성
    - 환경 레코드는 함수 안팎의 환경 기록한다.
4. 실행 문맥에 있는 디스 바인딩 컴포넌트에 그 함수를 호출한 객체의 참조를 저장하며, 이것이 this 값 결정
    - this는 함수를 호출하는 상황에 따라 가리키는 객체가 바뀜. 즉, 동적
5. 함수 실행
    - 환경 레코드에서 이에 대응하는 인수의 값 설정
    - 호이스팅이 가능한 이유 : 함수를 평가하는 시점에 선언적 환경 레코드에 기록되었기 때문
6. 함수 종료 후 실행 문맥 삭제


# this 값
- 함수가 호출되어 실행되는 시점에 this 값 결정
- 함수가 호출되었을 때 그 함수가 속해 있던 객체의 참조
- 실행 문맥의 디스 바인딩 컴포넌트가 참조하는 객체

- 어떤 상황에서 this가 어떤 객체를 가리키는가
    1) 최상위 레벨 코드 : 전역 객체
    2) event : 이벤트가 발생한 요소 객체
    3) 생성자 함수 안 : 생성자로 생성한 객체
    4) 생성자의 prototype 메서드 안 : 생성자로 생성한 객체
    5) 직접 호출한 함수 안 : 객체가 없다면 전역 객체
    6) apply, call 메서드로 호출한 함수 안 : 그 함수 객체가 실행되는 실행 문맥의 디스 바인딩 컴포넌트가 가리키는 객체

# 스코프(Scope)
- 참조 대상 식별자를 찾아내기 위한 규칙

## 스코프의 구분
### 전역 스코프
- 해당 스코프는 모두 전역 변수

1. 전역 스코프(Global Scope)
    - `전역 객체(Global Object) window`의 프로퍼티가 된다.
2. 비 블록 레벨 스코프(Non block-level scope)
    + 함수 밖에서 선언된 변수는 코드 내에서 선언되었다 하더라도 전역 스코프를 갖는다.
    ```javascript
    if (true) {
        var  x = 5;
    }
    console.log(x);
    ```
3. 암묵적 전역 변수
    - var 키워드를 생략한 변수

### 지역 스코프
1. 함수 레벨 스코프(Function-level Scope)    
    - 전역 변수와 지역 변수가 모두 참조 가능하나 우선적으로 지역변수를 참조한다.
2. 지역 스코프(Local Scope or Function-Level Scope)

### 렉시컬 스코프 
- 함수를 어디서 선언하였는지에 따라 결정
    cf) 동적 스코프

### 식별자의 결정 : 유효 범위 체인
- 현재의 유효 범위 안에 없는 식별자를 찾을 때 바깥쪽 범위로 호출자의 렉시컬 환경에 속한 외부 렉시컬 환경의 참조를 따라가는 방식을 취한다.
- 이는 클로저의 기본 지식    
    + 속박 변수 : 함수의 인수와 지역 변수
    + 자유 변수 : 그 이외의 변수
```javascript
var a = "A";

function f() {
    var b = "B";
    
    function g() {
        var c = "C";
        console.log(a+b+c);
        // a, b, c 사용 가능
    }
    g(); 
    // a, b 사용 가능
}

f(); // ABC
// a 사용 가능
```

# 클로저
- 자기 자신이 정의된 환경에서 함수 안에 있는 자유 변수의 식별자 결정을 실행한다.
- 위 코드에서 g()의 렉시컬 환경은 함수 g를 둘러싼 바깥 영역 전체
    > 함수 g의 함수 객체와 객체가 참조하는 렉시컬 환경 컴포넌트가 자유 변수 a, b의 식별자 결정을 위한 자료구조
- 핵심 사항
    + 외부 함수는 클로저를 생성하는 팩토리 함수
    + 외부 함수가 속한 렉시컬 환경 컴포넌트는 클로저 내부 상태 자체. 외부 함수가 호출될 때마다 새로 생성
    + 중첩 함수의 함수 객체가 있는 한 외부 함수가 속한 렉시컬 환경 컴포넌트는 지워지지 않음
    + 캡슐화 가능